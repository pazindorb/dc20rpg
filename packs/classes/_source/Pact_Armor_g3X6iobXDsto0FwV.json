{
  "name": "Pact Armor",
  "type": "feature",
  "img": "icons/equipment/head/mask-tiger-silver.webp",
  "system": {
    "description": "<p>You can choose an Armor in your possession and bond with it, making it your <strong>Pact</strong> <strong>Armor</strong>.</p><p>You can only have <strong>1 Pact Armor</strong> at a time. You gain the following benefits while wearing the Armor:</p><ul><li><p><strong>Armor </strong><span class=\"cf0\"><strong>Training:</strong> You’re considered to have Training with your Pact Armor.</span></p></li><li><p><span class=\"cf0\"><strong>Maneuvers:</strong> You learn 2 Defensive Maneuvers of your choice.</span></p></li><li><p><strong>Mystical</strong> <strong>Armor:</strong> You gain +1 AD and MDR.</p></li></ul><p><strong>Pocket Dimension:</strong> Using a<strong> Minor</strong> <strong>Action</strong>, you can dismiss the Armor into a pocket dimension, summon it from that pocket dimension, or summon it from anywhere on the same plane of existence. If you aren’t able to wear the Armor when you summon it, or you choose not to wear it, it appears in your Space at your feet.</p><p><strong>New Pact Armor:</strong> Over the course of a <strong>Quick</strong> <strong>Rest</strong>, you can touch an Armor in your possession, bond with it, and make it your new Pact Armor, ending your bond with your previous Pact Armor.</p>",
    "tableName": "",
    "source": "",
    "conditional": {
      "hasConditional": false,
      "condition": "",
      "bonus": "0",
      "useFor": "",
      "name": "",
      "linkWithToggle": false,
      "flags": {
        "ignorePdr": false,
        "ignoreMdr": false,
        "ignoreResistance": {},
        "ignoreImmune": {}
      },
      "effect": null
    },
    "isReaction": false,
    "actionType": "",
    "attackFormula": {
      "checkType": "attack",
      "targetDefence": "precision",
      "rollBonus": 0,
      "combatMastery": true,
      "critThreshold": 20,
      "formulaMod": "",
      "halfDmgOnMiss": false,
      "rangeType": "melee"
    },
    "duration": {
      "value": null,
      "type": "",
      "timeUnit": ""
    },
    "range": {
      "normal": null,
      "max": null,
      "unit": "",
      "melee": 1
    },
    "target": {
      "count": null,
      "invidual": true,
      "type": "",
      "areas": {
        "default": {
          "area": "",
          "distance": null,
          "width": null,
          "unit": "",
          "difficult": ""
        }
      }
    },
    "check": {
      "canCrit": false,
      "checkKey": "att",
      "contestedKey": "phy",
      "checkDC": 10,
      "multiCheck": {
        "active": false,
        "options": {}
      },
      "againstDC": true,
      "respectSizeRules": false,
      "failEffect": ""
    },
    "formulas": {},
    "enhancements": {},
    "copyEnhancements": {
      "copy": false,
      "copyFor": "",
      "linkWithToggle": false,
      "hideFromRollMenu": false
    },
    "save": {
      "type": "phy",
      "dc": null,
      "calculationKey": "spell",
      "addMastery": false,
      "failEffect": ""
    },
    "costs": {
      "resources": {
        "actionPoint": null,
        "stamina": null,
        "mana": null,
        "health": null,
        "custom": {},
        "grit": null,
        "restPoints": null
      },
      "charges": {
        "current": null,
        "max": null,
        "maxChargesFormula": "",
        "overriden": false,
        "rechargeFormula": "",
        "reset": "",
        "showAsResource": false,
        "rechargeDice": "",
        "requiredTotalMinimum": null,
        "subtract": 1
      },
      "otherItem": {
        "itemId": "",
        "amountConsumed": 0,
        "consumeCharge": true
      }
    },
    "featureType": "inner",
    "featureOrigin": "Pact Boon",
    "usesWeapon": {
      "weaponId": "",
      "weaponAttack": false
    },
    "effectsConfig": {
      "active": false,
      "addToChat": false,
      "linkWithToggle": true,
      "toggleItem": true
    },
    "isResource": false,
    "resource": {
      "name": "",
      "resourceKey": "key",
      "reset": "",
      "values": [
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0
      ],
      "useStandardTable": true,
      "customMaxFormula": ""
    },
    "macros": {
      "e4fK27t6bHGpXFx3": {
        "name": "Select Pact Armor",
        "trigger": "onCreate",
        "command": "const armors = actor.getAllItemsWithType(\"equipment\", [(item) => [\"light\", \"heavy\"].includes(item.system.equipmentType)]);\nconst selectOptions = DC20.tools.toSelectOptions(armors, \"id\", \"name\");\nconst selected = await DC20.dialog.SimplePopup.select(\"Select Pact Armor\", selectOptions);\nif (!selected) return;\n\nconst armor = actor.items.get(selected);\nif (!armor) return;\n\n// Add buff to new armor\nconst pactArmor = item.getEffectByKey(\"pactArmor\");\nif (pactArmor) {\n  const effectData = pactArmor.toObject();\n  effectData.transfer = true;\n  await game.dc20rpg.effects.createEffectOn(effectData, armor);\n  await item.update({[\"flags.dc20rpg.pactArmor\"]: armor.id});\n}\n// Add training to new armor\narmor.update({[\"system.combatTraining\"]: true});",
        "disabled": false,
        "title": ""
      },
      "eLXqYMgHAUbwSlws": {
        "name": "Remove Pact Armor",
        "trigger": "preDelete",
        "command": "// Remove buff and training from current armor\nconst oldArmor = actor.items.get(item.flags?.dc20rpg?.pactArmor);\nif (oldArmor) {\n  const oldEffect = oldArmor.getEffectByKey(\"pactArmor\");\n  await oldEffect.delete();\n  oldArmor.update({[\"system.combatTraining\"]: false});\n}",
        "disabled": false,
        "title": ""
      },
      "lfcJOR8JHb84qbs4": {
        "command": "const armors = actor.getAllItemsWithType(\"equipment\", [(item) => [\"light\", \"heavy\"].includes(item.system.equipmentType)]);\nconst selectOptions = DC20.tools.toSelectOptions(armors, \"id\", \"name\");\nconst selected = await DC20.dialog.SimplePopup.select(\"Select Pact Armor\", selectOptions);\nif (!selected) return;\n\nconst armor = actor.items.get(selected);\nif (!armor) return;\n\n// Remove buff and training from current armor\nconst oldArmor = actor.items.get(item.flags?.dc20rpg?.pactArmor);\nif (oldArmor) {\n  const oldEffect = oldArmor.getEffectByKey(\"pactArmor\");\n  await oldEffect.delete();\n  oldArmor.update({[\"system.combatTraining\"]: false});\n}\n\n// Add buff to new armor\nconst pactArmor = item.getEffectByKey(\"pactArmor\");\nif (pactArmor) {\n  const effectData = pactArmor.toObject();\n  effectData.transfer = true;\n  await game.dc20rpg.effects.createEffectOn(effectData, armor);\n  await item.update({[\"flags.dc20rpg.pactArmor\"]: armor.id});\n}\n// Add training to new armor\narmor.update({[\"system.combatTraining\"]: true});",
        "trigger": "onDemand",
        "disabled": false,
        "name": "Change Pact Armor",
        "title": "Change Pact Armor",
        "global": false
      }
    },
    "hasAdvancement": true,
    "advancements": {
      "default": {
        "name": "Pact Armor",
        "items": {},
        "customTitle": "Pact Armor - Maneuvers",
        "mustChoose": false,
        "pointAmount": 3,
        "allowToAddItems": true,
        "addItemsOptions": {
          "itemType": "maneuver",
          "preFilters": "{\"maneuverType\": \"defense\"}",
          "itemLimit": 2,
          "helpText": "Add Defense Maneuver"
        },
        "key": "default",
        "macro": "const maneuvers = Object.values(advancement.items);\nfor (const maneuver of maneuvers) {\n  const item = actor.items.get(maneuver.createdItemId);\n  if (item) await item.update({[\"system.knownLimit\"]: false});\n}"
      }
    },
    "toggle": {
      "toggleable": false,
      "toggledOn": false,
      "toggleOnRoll": false
    },
    "itemKey": "pactArmor",
    "choicePointCost": 1,
    "hideFromCompendiumBrowser": false,
    "quickRoll": false,
    "againstEffect": {
      "id": "",
      "supressFromChatMessage": false,
      "untilYourNextTurnStart": false,
      "untilYourNextTurnEnd": false,
      "untilTargetNextTurnStart": false,
      "untilTargetNextTurnEnd": false,
      "untilFirstTimeTriggered": false
    },
    "againstStatuses": {},
    "rollRequests": {},
    "help": {
      "ignoreMHP": false,
      "subtract": false
    }
  },
  "effects": [
    {
      "origin": "Item.p4FMBZcxE7zSXlrF",
      "duration": {
        "rounds": 1,
        "startTime": null,
        "seconds": null,
        "combat": null,
        "turns": null,
        "startRound": null,
        "startTurn": null
      },
      "disabled": false,
      "name": "Pact Armor",
      "img": "icons/equipment/head/mask-tiger-silver.webp",
      "_id": "1PXmFYaVHGv5Zmdu",
      "type": "base",
      "system": {
        "statusId": "",
        "disableWhen": {
          "mode": "=="
        },
        "effectKey": "pactArmor"
      },
      "changes": [
        {
          "key": "system.damageReduction.mdr.active",
          "mode": 5,
          "value": "true",
          "priority": null
        },
        {
          "key": "system.defences.area.bonuses.always",
          "mode": 2,
          "value": "1",
          "priority": null
        }
      ],
      "description": "<p>You gain the following benefits while wearing the Armor:</p><ul><li><p><strong>Armor </strong><span class=\"cf0\"><strong>Training:</strong> You’re considered to have Training with your Pact Armor.</span></p></li><li><p><span class=\"cf0\"><strong>Maneuvers:</strong> You learn 2 Defensive Maneuvers of your choice.</span></p></li><li><p><strong>Mystical</strong> <strong>Armor:</strong> You gain +1 AD and MDR.</p></li></ul>",
      "tint": "#ffffff",
      "transfer": false,
      "statuses": [],
      "sort": 0,
      "flags": {
        "dc20rpg": {
          "disableWhen": {
            "path": "",
            "mode": "==",
            "value": ""
          },
          "requireEnhancement": "",
          "duration": {
            "useCounter": false,
            "resetWhenEnabled": false,
            "onTimeEnd": ""
          },
          "effectKey": "",
          "addToChat": false,
          "nonessential": false
        }
      },
      "_stats": {
        "compendiumSource": null,
        "duplicateSource": null,
        "coreVersion": "13.350",
        "systemId": "dc20rpg",
        "systemVersion": "0.9.8.0",
        "createdTime": null,
        "modifiedTime": 1767180976461,
        "lastModifiedBy": "dOcXwrUs2VunZl0y",
        "exportSource": null
      },
      "_key": "!items.effects!g3X6iobXDsto0FwV.1PXmFYaVHGv5Zmdu"
    }
  ],
  "folder": "SDifcOAGjLwfwVrX",
  "flags": {},
  "_stats": {
    "compendiumSource": null,
    "duplicateSource": null,
    "coreVersion": "13.350",
    "systemId": "dc20rpg",
    "systemVersion": "0.10.0.0",
    "createdTime": 1739350033944,
    "modifiedTime": 1767181182123,
    "lastModifiedBy": "dOcXwrUs2VunZl0y",
    "exportSource": null
  },
  "_id": "g3X6iobXDsto0FwV",
  "sort": 0,
  "ownership": {
    "default": 0,
    "dOcXwrUs2VunZl0y": 3
  },
  "_key": "!items!g3X6iobXDsto0FwV"
}
