{
  "name": "Spell Duel",
  "type": "basicAction",
  "img": "icons/svg/explosion.svg",
  "system": {
    "description": "<p><span><em><strong>Prerequisite:</strong> Spellcasting</em> <em>Path</em></span></p><p>During a Spell Duel, the creature casting the Spell is referred to as the <strong>Caster</strong> and the opposing creature is referred to as the <strong>Challenger</strong>.</p><p>If multiple creatures attempt to initiate a Spell Duel, one of them must be chosen as the <strong>Challenger</strong>, while the others assist them through <strong>Combo Casting</strong>. Additional creatures can also choose to assist the Caster when a Spell Duel is initiated (see <strong>Combo Casting</strong> for more information).</p><p><strong>Trigger:</strong> You see an MP Effect being cast, provided the Caster or a target is within 5 Spaces of you.</p><p><strong>Reaction:</strong> You can spend an amount of AP and 1 or more MP (up to your Mana Spend Limit) to attempt to stop the Caster’s MP Effect. The amount of AP spent is equal to the base AP cost of the MP Effect you are trying to stop.</p><p></p><p><span style=\"text-decoration: underline;\"><strong><span style=\"text-decoration: underline;\">Contest</span></strong></span></p><p>Make a Spell Check contested by the Spell Check or Spell Attack that the Caster makes to cast their MP Effect.</p><p>If the Caster’s MP Effect doesn’t require a Check, they have to make a Spell Check as a Reaction as part of the Spell Duel.</p><p>For the purposes of the Spell Duel, the <strong>Caster</strong> and <strong>Challenger</strong> each gain a bonus to their Check equal to twice the MP spent they spent respectively.</p><p><em><strong>Beta Note:</strong> Since enemies don’t have MP costs for their MP Effects you can assume that their MP Effects cost an amount of MP equal to half their Level (rounded up).</em></p><p></p><p><span style=\"text-decoration: underline;\"><strong><span style=\"text-decoration: underline;\">Outcomes</span></strong></span></p><p><strong>Success:</strong> The Caster’s MP Effect fails and has no effect.</p><p><strong>Failure:</strong> The Caster’s MP Effect succeeds and takes effect. The Check bonus gained from MP spent doesn’t apply to the MP Effect’s Success and Failure Statements.</p><p><strong>Tie:</strong> The Caster’s MP Effect fails, has no effect, and you each roll on the @UUID[Compendium.dc20rpg.roll-tables.RollTable.HxkcpDT6pEOIfYUk]{Wild Magic Surge Table}. The effect from the table lasts for 1 Round.</p><p><strong>Resources Lost:</strong> Whatever the result, each creature still spends all AP, MP, or other resources as normal.</p><p></p><p><em><strong>Example:</strong> A Caster makes an MP based Spell Attack and a Challenger attempts to stop it. The Caster’s Spell Attack cost 1 AP and 2 MP. The Challenger must spend 1 AP and at least 1 MP to attempt to stop the Spell Attack. The Caster makes an Attack Check (since its a Spell Attack) and the Challenger makes a Spell Check. The Caster gets a +4 bonus to their Attack Check (2 MP spent) and the Challenger gets a +2 bonus to their Spell Check (1 MP spent). Should the Caster win the Contest, their MP Effect takes effect but they don’t include the +4 bonus from MP spent to determine if they score a Heavy Hit or higher.</em></p><p></p>",
    "tableName": "",
    "source": "",
    "choicePointCost": 1,
    "hideFromCompendiumBrowser": false,
    "macros": {
      "Yalv653kxQPs5FZf": {
        "name": "Trigger Spell Duel",
        "trigger": "preItemRoll",
        "command": "item.doNotSendToChat = true;\nconst contestantSpellCheck = game.i18n.localize(\"dc20rpg.dialog.spellDuel.contCheck\");\nconst contestantManaSpent = game.i18n.localize(\"dc20rpg.dialog.spellDuel.contMana\");\nconst yourManaSpent = game.i18n.localize(\"dc20rpg.dialog.spellDuel.yourMana\");\nconst header = game.i18n.localize(\"dc20rpg.dialog.spellDuel.header\");\nconst tieInfo = game.i18n.localize(\"dc20rpg.dialog.spellDuel.tie\");\n\nconst questions = [\n  {type: \"input\", label: contestantSpellCheck},\n  {type: \"input\", label: contestantManaSpent},\n  {type: \"input\", label: yourManaSpent}\n]\nconst answers = await DC20.dialog.SimplePopup.open(\"input\", {header: header, inputs: questions});\nconsole.log(answers)\nif (!answers) return;\n\nconst intValues = [];\nfor (let i = 0; i < answers.length; i++) {\n    const value = parseInt(answers[i]);\n    if (isNaN(value)) {\n        ui.notifications.error(`You must provide correct value for: '${questions[i]}' field`);\n        return;\n    }\n    else {\n        intValues.push(value);\n    }\n}\n\n// Prepare Spell Duel Roll\nconst contestDC = intValues[0] + (2*intValues[1]);\nconst manaBonus = intValues[2];\n\nconst rollFormula = `d20 + @attackMod.value.spell + ${(manaBonus * 2)}`;\n\nconst rollDetails = {\n  \"against\": contestDC,\n  \"checkKey\": \"spe\",\n  \"label\": `${header} vs ${contestDC}`,\n  \"roll\": rollFormula,\n  \"type\": \"spellCheck\",\n  \"description\": item.system.description,\n  \"costs\": {ap: 2, mana: manaBonus}\n}\n\nconst duelRoll = await DC20.dialog.RollDialog.open(actor, rollDetails);\n\nif (duelRoll?.total === contestDC) {\n  DC20.dialog.SimplePopup.info(header, [tieInfo])\n}",
        "disabled": false,
        "title": ""
      }
    },
    "isReaction": true,
    "toggle": {
      "toggleable": false,
      "toggledOn": false,
      "toggleOnRoll": false
    },
    "actionType": "",
    "attackFormula": {
      "rangeType": "melee",
      "checkType": "attack",
      "targetDefence": "precision",
      "rollBonus": 0,
      "combatMastery": false,
      "critThreshold": 20,
      "halfDmgOnMiss": false,
      "formulaMod": "physical"
    },
    "check": {
      "canCrit": false,
      "checkKey": "att",
      "contestedKey": "phy",
      "checkDC": 10,
      "failEffect": ""
    },
    "save": {
      "type": "phy",
      "dc": 0,
      "calculationKey": "spell",
      "addMastery": false,
      "failEffect": ""
    },
    "costs": {
      "resources": {
        "actionPoint": null,
        "stamina": null,
        "mana": null,
        "health": null,
        "custom": {}
      },
      "charges": {
        "current": null,
        "max": null,
        "maxChargesFormula": "",
        "overriden": false,
        "rechargeFormula": "",
        "rechargeDice": "",
        "requiredTotalMinimum": null,
        "reset": "",
        "showAsResource": false
      },
      "otherItem": {
        "itemId": "",
        "amountConsumed": 0,
        "consumeCharge": true
      }
    },
    "formulas": {},
    "enhancements": {},
    "copyEnhancements": {
      "copy": false,
      "copyFor": "",
      "linkWithToggle": false
    },
    "range": {
      "normal": null,
      "max": null,
      "unit": ""
    },
    "duration": {
      "value": null,
      "type": "",
      "timeUnit": ""
    },
    "target": {
      "count": null,
      "invidual": true,
      "type": "",
      "areas": {
        "default": {
          "area": "",
          "distance": null,
          "width": null,
          "unit": "",
          "difficult": ""
        }
      }
    },
    "conditional": {
      "hasConditional": false,
      "name": "",
      "condition": "",
      "useFor": "",
      "linkWithToggle": false,
      "bonus": "0"
    },
    "hasAdvancement": false,
    "advancements": {
      "default": {
        "name": "Item Advancement",
        "mustChoose": false,
        "pointAmount": 1,
        "level": 0,
        "applied": false,
        "talent": false,
        "repeatable": false,
        "repeatAt": [
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0
        ],
        "allowToAddItems": false,
        "additionalAdvancement": true,
        "compendium": "",
        "items": {}
      }
    },
    "effectsConfig": {
      "linkWithToggle": false,
      "active": false,
      "addToChat": false
    },
    "category": "reaction",
    "quickRoll": true,
    "itemKey": "spellDuel"
  },
  "effects": [],
  "folder": "atqX9E3XHYUrlhZg",
  "sort": 200000,
  "ownership": {
    "default": 0,
    "dOcXwrUs2VunZl0y": 3
  },
  "flags": {
    "dc20rpg": {
      "rollMenu": {
        "free": false,
        "dis": 0,
        "adv": 0,
        "apCost": 0,
        "d8": 0,
        "d6": 0,
        "d4": 0,
        "versatile": false,
        "ignoreConcentration": false,
        "ignoreMCP": false,
        "showMenu": false,
        "flanks": false,
        "halfCover": false,
        "tqCover": false,
        "autoCrit": false,
        "autoFail": false
      }
    }
  },
  "_stats": {
    "compendiumSource": "Item.hN1j1N0Bh8gTy0pG",
    "duplicateSource": "Item.1OVlkg9k0CcbBXYj",
    "coreVersion": "13.350",
    "systemId": "dc20rpg",
    "systemVersion": "0.10.0.0",
    "createdTime": 1732728815896,
    "modifiedTime": 1765887094027,
    "lastModifiedBy": "dOcXwrUs2VunZl0y",
    "exportSource": null
  },
  "_id": "fzPWHzvBu1EWJ7Fr",
  "_key": "!items!fzPWHzvBu1EWJ7Fr"
}
